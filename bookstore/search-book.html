<html>

<head>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Bootstrap libraries -->
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
        integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
        integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
        integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>

</head>

<body>
    <h1>Book Search</h1>
    <form id="isbnForm">
        <input name="isbn13" type="text" id="isbn13" class="form-control" placeholder="ISBN Number" required autofocus>
        <input type="submit">
    </form>

    <div id="results">
        <table id="booksTable" class='table table-striped' id='book-list' border='1'>
            <thead>
                <th>Title</th>
                <th>ISBN 13</th>
                <th>Price</th>
                <th>Availability</th>
            </thead>
        </table>
    </div>
    <label id="error" class="text-danger"></label>
</body>
<script>
    // Helper function to display error message
    function showError(message) {
        // Display an error under the the predefined label with error as the id
        $("#results").hide();
        $('#error').text(message);
        $('#error').show();
    }

    $(function () {
        $("#results").hide();

        //This is considered an event call
        //It listens to the isbnForm <form id="isbnForm">
        //When submitted button is clicked it perform a series of actions through a function
        $("#isbnForm").submit(async (event) => {
            //Prevents screen from refreshing when submitting as we are not going to another page
            event.preventDefault();

            $("#error").hide();

            //Get ISBN Number from the form
            var isbnNumber = $('#isbn13').val()
            var serviceURL = "http://127.0.0.1:5000/book/" + isbnNumber;

            try {
                const response =
                    await fetch(
                        serviceURL, { method: 'GET' }
                    );
                const data = await response.json();
                if (response.ok) {
                    foundBook =
                        "<tbody>" +
                        "<tr>" +
                        "<td>" + data.title + "</td>" +
                        "<td>" + data.isbn13 + "</td>" +
                        "<td>" + data.price + "</td>" +
                        "<td>" + data.availability + "</td>" +
                        "</tr>" +
                        "<tbody>";
                    // $('#message').hide();
                    $("#results").show();
                    $('#booksTable tbody').empty();
                    $('#booksTable').append(foundBook);
                } else {
                    showError(data.message);
                }

            } catch (error) {
                // Errors when calling the service; such as network error, 
                // service offline, etc
                showError
                    ('There is a problem retrieving books data, please try again later.<br />' + error);

            }
        })
    });
</script>
</html>